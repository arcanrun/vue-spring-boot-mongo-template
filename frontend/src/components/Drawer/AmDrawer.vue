<template>
  <!-- HIDING: top-0 left-0 -translate-x-full fixed-->
  <div v-if="isVisible()" :class="classesWrapper">
    <div :class="classes">
      <button @click="hideDrawer" type="button" data-drawer-hide="drawer-body-scrolling"
              aria-controls="drawer-body-scrolling"
              class="absolute top-2.5 end-2.5 inline-flex items-center justify-center visible xl:invisible text-gray-400 bg-transparent hover:bg-gray-100 hover:text-gray-800 rounded-lg text-sm w-7 h-7">
      <span class="w-3 h-3">
      <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
      </svg>
      </span>
        <span class="sr-only">Close menu</span>
      </button>

      <RouterLink to="/profile" v-slot="{ isActive, href, navigate }">
        <a
          v-bind="$attrs"
          :href="href"
          @click="navigate"
        >
          <div
            @click="hideDrawer"
            :class="isActive
                      ? ['flex', 'row', 'items-center', 'p-4', 'transition-all', 'text-blue-600', 'bg-blue-100', 'hover:bg-blue-200', 'hover:text-blue-800']
                      : ['flex', 'row', 'items-center', 'p-4', 'transition-all', 'hover:bg-blue-200', 'hover:text-blue-800']">
            <div>
              <AmProfileAvatar :size="'sm'"/>
            </div>
            <div class="flex font-bold pl-3">
              {{ user.fullName }}
            </div>
          </div>
        </a>
      </RouterLink>

      <AmDrawerMenu>
        <AmDrawerMenuItem to="/">
          <template v-slot:icon>
            <svg class="w-5 h-5 text-gray-500 transition duration-75 group-hover:text-gray-900"
                 aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 22 21">
              <path d="M16.975 11H10V4.025a1 1 0 0 0-1.066-.998 8.5 8.5 0 1 0 9.039 9.039.999.999 0 0 0-1-1.066h.002Z"/>
              <path
                d="M12.5 0c-.157 0-.311.01-.565.027A1 1 0 0 0 11 1.02V10h8.975a1 1 0 0 0 1-.935c.013-.188.028-.374.028-.565A8.51 8.51 0 0 0 12.5 0Z"/>
            </svg>
          </template>

          <template v-slot:name>
            Home
          </template>
        </AmDrawerMenuItem>
        <AmDrawerMenuItem to="/my-bookings">
          <template v-slot:icon>
            <svg class="w-5 h-5 text-gray-500 transition duration-75 group-hover:text-gray-900"
                 width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd"
                    d="M3.2921 5.36949C3.23584 5.56369 3.22512 8.35096 3.26263 8.6651L18.2314 8.67367C18.2742 8.39666 18.2608 5.60938 18.2072 5.38663C18.1108 4.96968 17.7893 4.68696 17.307 4.67553L17.1945 4.67256C16.7944 4.66176 16.0144 4.64071 15.7477 4.68981L15.7424 6.66603L14.5019 6.67174L14.4965 4.68696L7.01084 4.67553L7.0028 6.65747L5.75429 6.67174L5.75161 4.6841C5.35511 4.65178 4.82867 4.66275 4.39499 4.67178L4.20839 4.67553C3.71542 4.6841 3.40999 4.95826 3.2921 5.36949ZM4.73333 3.35152C5.06848 3.36831 5.40951 3.38539 5.75161 3.3333L5.75429 2.01106H6.99208L7.0028 3.33616L14.4912 3.34472L14.4939 2.01963C14.5635 2.0082 15.67 1.97393 15.7236 2.03676C15.7811 2.14029 15.7653 2.66902 15.7542 3.03773L15.7542 3.03781C15.7503 3.16742 15.747 3.27725 15.7477 3.34187C15.9451 3.34944 16.1843 3.34437 16.4376 3.339C17.0439 3.32614 17.7306 3.31158 18.1161 3.46467C18.6895 3.69599 19.1557 4.20147 19.37 4.80119C19.5345 5.25849 19.5146 6.21709 19.5 6.92018C19.4969 7.0645 19.4942 7.19806 19.4933 7.3143C19.4911 7.67842 19.4929 8.0435 19.4948 8.40875V8.40899V8.40923V8.40947V8.40971C19.4974 8.93791 19.5001 9.46648 19.4906 9.99305L3.26531 10.0016C3.22512 10.2301 3.24923 17.1983 3.25191 17.9151L3.25221 18.0208C3.2531 18.5281 3.25374 18.8937 3.59485 19.1317C3.95744 19.3878 5.14095 19.3535 5.93315 19.3305L5.93326 19.3305C6.11273 19.3253 6.2721 19.3207 6.3973 19.3201C6.56843 19.3195 6.84401 19.3165 7.17748 19.3128C8.37893 19.2995 10.3318 19.2779 10.8582 19.3316C11.2681 19.3715 11.5414 19.7828 11.3672 20.2626C11.2156 20.6813 10.9083 20.6738 10.4741 20.6631C10.402 20.6614 10.3263 20.6595 10.2473 20.6595H4.2968C3.75025 20.6595 3.46357 20.631 3.06705 20.3768C2.49102 20.0055 2.00072 19.3915 2.0034 18.352C2.00742 17.2938 2.00541 16.2363 2.0034 15.1792C2.00139 14.1223 1.99938 13.0658 2.0034 12.0093C2.00723 11.0029 2.00498 9.99597 2.00273 8.98896C2.00026 7.88124 1.99779 6.77348 2.0034 5.6665C2.00876 4.62698 2.47494 4.01584 3.06169 3.63316C3.58413 3.29395 4.14982 3.32229 4.73333 3.35152ZM20.7225 16.3612C20.5886 14.3279 18.8578 12.4745 16.7251 12.6801C15.5811 12.7915 14.7532 13.3798 14.2147 13.9995C13.6682 14.6306 13.1779 15.7301 13.2556 16.9524C13.3922 19.0571 15.1337 20.7792 17.2771 20.6449C19.2275 20.5221 20.8726 18.663 20.7225 16.3612ZM13.1672 13.2255C14.0191 12.1632 15.0399 11.5606 16.4197 11.3607C19.2918 10.9437 21.7379 13.4112 21.971 16.0185C22.046 16.8696 21.9791 17.6635 21.746 18.3888C21.1539 20.2251 19.466 21.7787 17.5986 21.97C15.9214 22.1385 14.7131 21.5645 13.77 20.7506C11.6239 18.9 11.4203 15.4017 13.1672 13.2255ZM17.615 16.0043L17.5855 15.9558C17.5599 15.8486 17.5655 15.1641 17.5699 14.6222V14.6222L17.5699 14.622L17.5699 14.621L17.5699 14.6204C17.572 14.3693 17.5738 14.149 17.5721 14.0313L17.5725 14.0313C17.5742 14.1492 17.5724 14.3704 17.5703 14.6225C17.5659 15.1644 17.5603 15.8489 17.5859 15.9561L17.6154 16.0047C17.6189 16.008 17.6223 16.011 17.6258 16.0139C17.6222 16.011 17.6186 16.0078 17.615 16.0043ZM19.469 16.0503V17.3009H16.391V17.3012H19.4694V16.0503H19.469ZM17.6154 16.0047L18.9951 15.9961L19.4774 16.0104L19.4962 17.3183L16.3642 17.3355L16.3749 13.997L17.5912 14.0056C17.608 14.025 17.6139 14.0093 17.6167 14.0099C17.6194 14.0103 17.6195 14.0244 17.6234 14.0913L17.6154 16.0047ZM9.48397 13.3341L5.12758 13.3227L5.12491 12.0176C5.35824 11.9618 6.22888 11.9801 6.82749 11.9927H6.82754C7.02622 11.9969 7.19493 12.0004 7.30042 12.0004C7.52959 12.0004 7.76171 11.9984 7.99483 11.9964H7.99485H7.99486C8.49761 11.9921 9.00499 11.9877 9.49737 12.0033L9.48397 13.3341ZM5.12784 17.3297L9.49762 17.3268L9.48422 15.996L5.12784 16.0046V17.3297Z"
                    fill="#1E293B"/>
            </svg>
          </template>

          <template v-slot:name>
            My bookings
          </template>
        </AmDrawerMenuItem>
        <AmDrawerMenuItem to="/orders">
          <template v-slot:icon>
            <svg class="w-5 h-5 text-gray-500 transition duration-75 group-hover:text-gray-900"
                 width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd"
                    d="M12.4448 19.0862V5.48667C12.5086 5.47155 12.5704 5.44011 12.6318 5.41251L13.1979 5.18125C14.4766 4.66516 16.0613 4.29345 17.4236 4.09342C17.5641 4.07282 18.214 3.99143 18.3722 3.98639L19.3852 3.93084V17.586L18.3996 17.6416C18.0051 17.6515 16.9032 17.8153 16.528 17.8815C15.9883 17.9767 15.3284 18.123 14.8022 18.2695C13.9776 18.499 13.4197 18.6926 12.6404 19.0069C12.5765 19.0326 12.5071 19.0716 12.4449 19.0863L12.4448 19.0862ZM2 5.23657V20.1975L2.60261 20.1971C2.68649 20.1968 2.70851 20.2096 2.77976 20.2118C2.90024 20.2154 3.02849 20.2115 3.14983 20.2114C3.4059 20.2113 4.64188 20.2807 4.88456 20.3125C5.09356 20.3398 5.32373 20.3562 5.54309 20.3805C6.23087 20.4569 6.78404 20.5579 7.46016 20.6716C8.108 20.7806 8.89726 20.9841 9.54564 21.153C9.59778 21.1665 9.63125 21.1771 9.68436 21.1927C9.73877 21.2088 9.78023 21.2175 9.83517 21.2341C10.0229 21.2911 10.2157 21.3436 10.3933 21.404C10.8837 21.571 11.2505 21.6883 11.7449 21.8939C12.0698 22.029 11.924 22.0409 12.257 21.8959C12.3501 21.8554 12.4228 21.8272 12.5212 21.7889C12.7019 21.7187 12.8659 21.6547 13.0523 21.5917C14.4606 21.1156 15.6943 20.8028 17.1599 20.5646C17.6372 20.487 17.9878 20.4488 18.4468 20.384C18.6688 20.3527 18.9029 20.3399 19.1153 20.3124C19.341 20.2831 20.6018 20.2109 20.8364 20.2113C20.9592 20.2114 21.0839 20.2133 21.2065 20.2118C21.2825 20.2108 21.2936 20.1978 21.3698 20.1968L22 20.1973V5.19472H21.165C21.1334 5.19472 21.1239 5.20436 21.1239 5.23635V19.3499C20.8364 19.3499 20.2631 19.3509 19.9976 19.3878C19.9243 19.398 19.5398 19.4061 19.3679 19.4294C19.2304 19.4481 18.9224 19.458 18.7616 19.4808C18.6615 19.4949 18.544 19.5077 18.4533 19.5153C18.0487 19.5493 17.6598 19.6154 17.2765 19.6686C15.7723 19.8771 13.9107 20.3418 12.4843 20.8621C11.8769 21.0836 12.1763 21.1206 11.5357 20.8698C11.4517 20.8369 11.372 20.8087 11.2933 20.7823C10.3807 20.4756 9.37582 20.1689 8.4283 19.9807C8.23949 19.9432 8.05607 19.8967 7.87093 19.8655C7.68546 19.8343 7.50269 19.8001 7.31507 19.7629C6.99261 19.6988 6.50022 19.635 6.16092 19.5866C5.85098 19.5424 5.5514 19.5236 5.26413 19.4825C5.0465 19.4514 4.45123 19.4138 4.18976 19.392C4.07609 19.3826 3.85489 19.3878 3.70764 19.3673C3.59439 19.3515 3.03561 19.3497 2.87638 19.3497V5.19439H2.04135C2.00982 5.19439 2.00032 5.20403 2.00032 5.23602L2 5.23657ZM4.61457 3.93074C5.69099 3.93074 7.36764 4.17569 8.39009 4.43346C9.09741 4.61181 9.75075 4.79771 10.424 5.03664C10.5596 5.08473 10.6808 5.13315 10.8136 5.183L11.5685 5.50047V19.0862L11.195 18.9374C10.4188 18.622 9.60685 18.3699 8.79513 18.1639L7.9329 17.9692C7.34206 17.8493 6.70156 17.7489 6.10424 17.6856L5.36734 17.6277C5.30796 17.6248 5.31736 17.6169 5.25787 17.6137L4.61446 17.586V3.93084L4.61457 3.93074ZM3.73851 18.4333C5.87095 18.4333 7.32068 18.6529 9.28557 19.2081L10.2312 19.5127C10.6406 19.6772 11.1493 19.8381 11.5687 20.0446C12.0723 20.2925 11.9493 20.2826 12.1984 20.1557C12.2677 20.1204 12.3387 20.0901 12.4127 20.0537C12.486 20.0177 12.5562 19.9879 12.6325 19.9573C12.9887 19.8146 13.6438 19.5362 13.9837 19.4393C14.075 19.4132 14.1385 19.3907 14.2226 19.3622C14.7743 19.175 15.6378 18.9477 16.1944 18.835C16.8527 18.7017 17.6797 18.5571 18.3594 18.5038C18.4542 18.4964 18.5583 18.4951 18.6517 18.4808C18.8332 18.4531 20.0597 18.4333 20.2612 18.4333V3.00011L19.2109 3.00394C19.1235 3.0161 18.791 3.01457 18.6654 3.03374C18.5071 3.05795 18.3199 3.05576 18.1356 3.07953C18.0415 3.09169 17.9651 3.09005 17.8714 3.10309C17.6967 3.12741 17.5298 3.14866 17.3603 3.16794C16.5071 3.26467 15.3253 3.55071 14.5147 3.78087C13.9422 3.94344 12.7434 4.36433 12.1985 4.63941C12.1627 4.65749 12.1333 4.66636 12.0934 4.68553C12.0592 4.70197 12.0218 4.72935 11.9957 4.72749L11.1991 4.37529C10.926 4.26431 10.6495 4.15937 10.3589 4.06099C9.91733 3.91156 9.48464 3.77331 9.03631 3.65281C8.24219 3.4394 7.48715 3.28779 6.63992 3.1675C6.46999 3.1434 6.30439 3.12752 6.12853 3.10309C5.83144 3.06179 5.37468 3.04064 5.06571 3.01468C4.96823 3.00646 4.87431 3.01578 4.78892 3.00383L3.73862 3V18.4332L3.73851 18.4333Z"
                    fill="#1E293B"/>
            </svg>
          </template>

          <template v-slot:name>
            Orders
          </template>
        </AmDrawerMenuItem>

        <div @click="() => user.logout() " class="font-medium absolute bottom-0 w-full">
          <AmDrawerMenuItem to="/login">
            <template v-slot:icon>
              <svg
                class="flex-shrink-0 w-5 h-5 text-gray-500 transition duration-75 group-hover:text-gray-900"
                width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M5 21C4.45 21 3.97917 20.8042 3.5875 20.4125C3.19583 20.0208 3 19.55 3 19V5C3 4.45 3.19583 3.97917 3.5875 3.5875C3.97917 3.19583 4.45 3 5 3H12V5H5V19H12V21H5ZM16 17L14.625 15.55L17.175 13H9V11H17.175L14.625 8.45L16 7L21 12L16 17Z"
                  fill="#1E293B"/>
              </svg>
            </template>
            <template v-slot:name>Log out</template>
          </AmDrawerMenuItem>
        </div>
      </AmDrawerMenu>
    </div>
  </div>
</template>
<script setup lang="ts">
import { computed } from 'vue'
import { useLayoutStore } from '@/stores/layout'
import { useUserStore } from '@/stores/user'
import AmDrawerMenuItem from '@/components/Drawer/AmDrawerMenuItem.vue'
import AmDrawerMenu from '@/components/Drawer/AmDrawerMenu.vue'
import AmProfileAvatar from '@/components/Avatar/AmProfileAvatar.vue'

const user = useUserStore()
const layout = useLayoutStore()
const classes = computed(() => {
  const classes = [
    'overflow-hidden',
    'z-40',
    'h-screen',
    'overflow-y-auto',
    'transition-transform',
    'bg-white',
    'w-full',
    'border-r-2',
    'border-gray-200',
    'fixed',
    'top-0',
    'left-0',
    'md:w-64',
    'xl:fixed',
    'xl:translate-x-0',
    'xl:z-1'
  ]

  if (layout.drawer) {
    return classes
  }

  return [...classes, '-translate-x-full']
})
const classesWrapper = computed(() => {
  const classes = [
    'h-screen',
    'relative',
    'w-0',
    'xl:w-64'
  ]

  if (layout.drawer) {
    return classes
  }

  return [...classes]
})

const hideDrawer = () => {
  layout.drawer = false
}

const isVisible = () => {
  return user.state.isAuthenticated
}

</script>
<script lang="ts">
export default {
  name: 'AmDrawer'
}
</script>
